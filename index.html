<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTI User Info</title>
    <script>
        async function fetchUserInfo() {
            try {
                const response = await fetch('/api/test', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token') // Pegue o token armazenado
                    }
                });
                const data = await response.json();
                console.log('Autenticado:', data);
            } catch (error) {
                console.error('Erro ao buscar dados do usuário:', error);
            }
        }

        window.onload = function() {
            fetchUserInfo();

            const urlParams = new URLSearchParams(window.location.search);
            console.log("URL Params:", urlParams.toString());

            const username = urlParams.get('User.username');
            const course = urlParams.get('CourseTemplate.title');
            const date = urlParams.get('ResourceLink.available.startDateTime');

            if (username) {
                document.getElementById('username').textContent = `Nome do aluno: ${username}`;
            } else {
                document.getElementById('username').textContent = "Nome do aluno não encontrado.";
            }

            if (course) {
                document.getElementById('course').textContent = `Curso: ${course}`;
            } else {
                document.getElementById('course').textContent = "Nome do curso não encontrado.";
            }

            if (date) {
                document.getElementById('date').textContent = `Data de início: ${date}`;
            } else {
                document.getElementById('date').textContent = "Data de início não encontrada.";
            }
        };
    </script>
</head>
<body>
    <h1>Informações LTI</h1>
    <p id="username">Carregando nome do aluno...</p>
    <p id="course">Carregando nome do curso...</p>
    <p id="date">Carregando data de início...</p>
</body>
</html>
